{"version":3,"sources":["pages/Login/index.module.css","utils/axios.js","utils/index.js","pages/Login/index.js","utils/api/City/index.js","utils/api/Login/index.js"],"names":["module","exports","BASE_URL","api","axios","create","baseURL","interceptors","request","use","config","loading","url","headers","startsWith","includes","authorization","getToken","error","Promise","reject","response","hide","body","data","description","status","CURR_CITY","HKZF_TOKEN","setLocal","key","val","window","localStorage","setItem","getLocal","getItem","removeToken","console","log","removeItem","isAuth","getCityName","a","resolve","BMap","LocalCity","get","res","name","getCurrcity","curCity","JSON","parse","reslName","substr","label","getCityInfo","stringify","Login","this","props","values","errors","handleChange","handleSubmit","className","styles","root","mode","size","onSubmit","formItem","input","value","username","onChange","placeholder","type","password","formSubmit","submit","backHome","Item","to","Component","NewLogin","withFormik","mapPropsToValues","validationSchema","yup","shape","required","matches","history","location","getLogin","success","token","backUrl","push","fail","params","getCityList","level","getCityData","post","getUser","userLogout","getFav","id","addFav","delFav","delete","getUserHouses"],"mappings":"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","file":"static/js/16.837a0ea5.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Login_root__2XsWF\",\"navHeader\":\"Login_navHeader__3zbch\",\"backHome\":\"Login_backHome__1SQac\",\"formItem\":\"Login_formItem__yw08g\",\"input\":\"Login_input__sLCHV\",\"formSubmit\":\"Login_formSubmit__2F_Ic\",\"submit\":\"Login_submit__2kzkR\",\"error\":\"Login_error__nq8MS\"};","import axios from \"axios\"\n// loading组件\nimport { Toast } from \"antd-mobile\"\nimport { getToken } from \"./index.js\"\n\n// baseurl\nconst BASE_URL = \"https://api-haoke-web.itheima.net\"\n\n//封装axios\nconst api = axios.create({\n  baseURL: BASE_URL,\n})\n\n//请求拦截器\napi.interceptors.request.use(\n  function (config) {\n    Toast.loading(\"Loading...\", 0)\n    const switchUser = [\"/user/registered\", \"/user/login\"]\n    const { url, headers } = config\n\n    if (url.startsWith(\"/user\") && !switchUser.includes(url)) {\n      headers.authorization = getToken()\n    }\n\n    // Do something before request is sent\n    return config\n  },\n  function (error) {\n    // Do something with request error\n    return Promise.reject(error)\n  }\n)\n\n// 响应拦截器\n// Add a response interceptor\napi.interceptors.response.use(\n  function (response) {\n    Toast.hide()\n    // console.log(response)\n\n    const res = {\n      body: response.data.body,\n      description: response.data.description,\n      status: response.data.status,\n    }\n    // Any status code that lie within the range of 2xx cause this function to trigger\n    // Do something with response data\n    return res\n  },\n  function (error) {\n    // Any status codes that falls outside the range of 2xx cause this function to trigger\n    // Do something with response error\n    return Promise.reject(error)\n  }\n)\n\nexport default api\nexport { BASE_URL }\n","import { getCityInfo } from \"./api/City/index.js\"\n\nconst CURR_CITY = \"curr_city\",\n  HKZF_TOKEN = \"HKZF_TOKEN\"\n// 封装本地存储方法\n// 添加本地存储\nexport function setLocal(key, val) {\n  return window.localStorage.setItem(key, val)\n}\n// 获取本地存储\nexport function getLocal(key) {\n  return localStorage.getItem(key)\n}\n\n// 删除本地存储\nexport function deLocal(key) {\n  return localStorage.removeItem(key)\n}\n\n// 封装持久化token\nexport function setToken(token) {\n  setLocal(HKZF_TOKEN, token)\n}\n\nexport function getToken() {\n  return getLocal(HKZF_TOKEN)\n}\n\nexport function removeToken() {\n  console.log(\"1\")\n\n  deLocal(HKZF_TOKEN)\n}\n\n// 判断鉴权\nconst isAuth = () => !!getToken()\n\nconst getCityName = async () => {\n  return new Promise((resolve, reject) => {\n    // 根据ip获取城市定位信息\n    let myCity = new window.BMap.LocalCity()\n    // 调用获取定位城市实例\n    myCity.get((res) => {\n      // 调用接口获取城市详细信息\n      resolve(res.name)\n    })\n  })\n}\n\nexport async function getCurrcity() {\n  // 从本地获取之前保存过的城市定位信息\n  const curCity = JSON.parse(getLocal(CURR_CITY))\n  // console.log(curCity)\n\n  let res = await getCityName()\n  let reslName = res.substr(0, 2)\n\n  // console.log(reslName)\n\n  if (!curCity || reslName !== curCity.label) {\n    // 如果没有\n    // 获取定位信息，返回promise对象，resolve结果\n    return new Promise(async (resolve, reject) => {\n      // 调用接口获取城市详细信息\n      const { status, body } = await getCityInfo(reslName)\n      if (status === 200) {\n        // 存储到本地\n        setLocal(CURR_CITY, JSON.stringify(body))\n        // console.log(body)\n\n        // 传递数据\n        resolve(body)\n      } else {\n        reject(\"error\")\n      }\n    })\n  } else {\n    // 如果有，返回信息\n    return Promise.resolve(curCity)\n  }\n}\n\nexport { CURR_CITY, HKZF_TOKEN, isAuth }\n","import React, { Component } from \"react\"\nimport { Flex, WingBlank, WhiteSpace, NavBar, Toast } from \"antd-mobile\"\n\nimport { Link } from \"react-router-dom\"\n\nimport styles from \"./index.module.css\"\nimport { getLogin } from \"../../utils/api/Login/index.js\"\nimport { setLocal, HKZF_TOKEN } from \"../../utils\"\n\nimport { withFormik } from \"formik\"\n\nimport * as yup from \"yup\"\n\n// 验证规则：\nconst REG_UNAME = /^[a-zA-Z_\\d]{5,8}$/\nconst REG_PWD = /^[a-zA-Z_\\d]{5,12}$/\n\nclass Login extends Component {\n  // state = {\n  //   username: \"\",\n  //   password: \"\",\n  // }\n\n  // login = async (e) => {\n  //   e.preventDefault()\n  //   const { username, password } = this.state\n  //   const { status, body, description } = await getLogin({ username, password })\n  //   if (status === 200) {\n  //     Toast.success(description)\n  //     setLocal(HKZF_TOKEN, body.token)\n  //     this.props.history.push(\"/\")\n  //   } else {\n  //     Toast.fail(description)\n  //   }\n  // }\n  // getInFormation = (e) => {\n  //   this.setState({\n  //     [e.target.name]: e.target.value,\n  //   })\n  //   console.log(e.target.value)\n  // }\n\n  render() {\n    const { values, errors, handleChange, handleSubmit } = this.props\n    return (\n      <div className={styles.root}>\n        {/* 顶部导航 */}\n        <NavBar mode=\"light\">账号登录</NavBar>\n        <WhiteSpace size=\"xl\" />\n\n        {/* 登录表单 */}\n        <WingBlank>\n          <form onSubmit={handleSubmit}>\n            <div className={styles.formItem}>\n              <input\n                className={styles.input}\n                name=\"username\"\n                value={values.username}\n                onChange={handleChange}\n                placeholder=\"请输入账号\"\n              />\n            </div>\n            {/* 长度为5到8位，只能出现数字、字母、下划线 */}\n            {errors.username && (\n              <div className={styles.error}>{errors.username}</div>\n            )}\n            <div className={styles.formItem}>\n              <input\n                className={styles.input}\n                name=\"password\"\n                type=\"password\"\n                value={values.password}\n                onChange={handleChange}\n                placeholder=\"请输入密码\"\n              />\n            </div>\n            {/* 长度为5到12位，只能出现数字、字母、下划线 */}\n            {errors.password && (\n              <div className={styles.error}>{errors.password}</div>\n            )}\n            <div className={styles.formSubmit}>\n              <button className={styles.submit} type=\"submit\">\n                登 录\n              </button>\n            </div>\n          </form>\n          <Flex className={styles.backHome}>\n            <Flex.Item>\n              <Link to=\"/registe\">还没有账号，去注册~</Link>\n            </Flex.Item>\n          </Flex>\n        </WingBlank>\n      </div>\n    )\n  }\n}\n\nconst NewLogin = withFormik({\n  mapPropsToValues: () => ({ username: \"\", password: \"\" }),\n\n  // Custom sync validation\n  validationSchema: yup.object().shape({\n    username: yup\n      .string()\n      .required(\"账号为必添项！\")\n      .matches(REG_UNAME, \"长度为5到8位，只能出现数字、字母、下划线\"),\n    password: yup\n      .string()\n      .required(\"密码为必添项！\")\n      .matches(REG_PWD, \"长度为5到12位，只能出现数字、字母、下划线\"),\n  }),\n\n  handleSubmit: async (values, { props: { history, location } }) => {\n    const { username, password } = values\n    const { status, body, description } = await getLogin({ username, password })\n    if (status === 200) {\n      Toast.success(description, 2)\n      setLocal(HKZF_TOKEN, body.token)\n\n      // console.log(this.props.history.location.data.backUrl)\n      if (location.data?.backUrl) {\n        history.push(location.data.backUrl)\n      } else {\n        history.push(\"/home/profile\")\n      }\n\n      // frb.props.history.push(\"/home/profile\")\n    } else {\n      Toast.fail(description)\n    }\n  },\n\n  // displayName: \"BasicForm\",\n})(Login)\n\nexport default NewLogin\n","import api from \"../../axios.js\"\n\n// 城市列表\nexport function getCityInfo(name) {\n  return api.get(\"/area/info\", {\n    params: {\n      name,\n    },\n  })\n}\n\n// 获取城市列表数据\nexport function getCityList(level = 1) {\n  return api.get(\"/area/city\", {\n    params: {\n      level,\n    },\n  })\n}\n\n//获取热门城市\nexport function getCityData() {\n  return api.get(\"/area/hot\")\n}\n","import api from \"../../axios.js\"\n// import { getToken } from \"../../index.js\"\n\n// 登录接口\nexport function getLogin(body) {\n  return api.post(\"/user/login\", body)\n}\n\n// 获取用户的信息资料\n\nexport function getUser(token) {\n  return api.get(\n    \"/user\"\n    // headers: {\n    //   authorization: token,\n    // },\n  )\n}\n\n//  用户登出接口\n\nexport function userLogout() {\n  return api.post(\n    \"/user/logout\",\n    null\n    // headers: {\n    //   authorization: getToken(),\n    // },\n  )\n}\n\n// 查看收藏列表\nexport function getFav(id) {\n  return api.get(`/user/favorites/${id}`)\n}\n\n// 添加收藏\nexport function addFav(id) {\n  return api.post(`/user/favorites/${id}`)\n}\n\n// 删除收藏\nexport function delFav(id) {\n  return api.delete(`/user/favorites/${id}`)\n}\n\n// 定义用户发布房源的API\n// 获取已发布房源\nexport const getUserHouses = () => {\n  return api.get(\"/user/houses\")\n}\n"],"sourceRoot":""}